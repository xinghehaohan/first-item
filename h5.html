<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../css/h5.css">
    <style>
    </style>
    <script>
        (function() {
            var userScalable = "no";
            var ins = "";
            if (window.devicePixelRatio === 1.5) {
                userScalable = "yes";
                ins = "initial-scale=0.5 ,"
            }
            var text = "<meta content='"+ins+" target-densitydpi=device-dpi, width=750,shrink-to-fit=no, maximum-scale=2, user-scalable=" + userScalable + "' name='viewport'>";
            document.write(text);
        })();
    </script>
</head>
<body>
<div id="loading-wrap">
    <svg viewBox="0 0 120 120" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <g id="circle" class="g-circles g-circles--v3">
            <circle id="12" transform="translate(35, 16.698730) rotate(-30) translate(-35, -16.698730) " cx="35" cy="16.6987298" r="10"></circle>
            <circle id="11" transform="translate(16.698730, 35) rotate(-60) translate(-16.698730, -35) " cx="16.6987298" cy="35" r="10"></circle>
            <circle id="10" transform="translate(10, 60) rotate(-90) translate(-10, -60) " cx="10" cy="60" r="10"></circle>
            <circle id="9" transform="translate(16.698730, 85) rotate(-120) translate(-16.698730, -85) " cx="16.6987298" cy="85" r="10"></circle>
            <circle id="8" transform="translate(35, 103.301270) rotate(-150) translate(-35, -103.301270) " cx="35" cy="103.30127" r="10"></circle>
            <circle id="7" cx="60" cy="110" r="10"></circle>
            <circle id="6" transform="translate(85, 103.301270) rotate(-30) translate(-85, -103.301270) " cx="85" cy="103.30127" r="10"></circle>
            <circle id="5" transform="translate(103.301270, 85) rotate(-60) translate(-103.301270, -85) " cx="103.30127" cy="85" r="10"></circle>
            <circle id="4" transform="translate(110, 60) rotate(-90) translate(-110, -60) " cx="110" cy="60" r="10"></circle>
            <circle id="3" transform="translate(103.301270, 35) rotate(-120) translate(-103.301270, -35) " cx="103.30127" cy="35" r="10"></circle>
            <circle id="2" transform="translate(85, 16.698730) rotate(-150) translate(-85, -16.698730) " cx="85" cy="16.6987298" r="10"></circle>
            <circle id="1" cx="60" cy="10" r="10"></circle>
        </g>
    </svg>
</div>

<div id="wrap">
    <section class="section bg1 s1">
        <img src="../img/h5/computer.gif" alt="" class="computer abs">
        <div class="console">
            <div class="line1"><span class="cursor" data-word="缩短二战3年"></span></div>
            <div class="line2"><span class="cursor" data-word="拯救2千万生命"></span></div>
            <div class="line3"><span class="cursor" data-word="他是谁？"></span></div>
        </div>
        <div class="runner js-down">
            <div class="r r1"></div>
            <div class="r r2"></div>
            <div class="r r3"></div>
        </div>
    </section>


    <section class="section s2 bg1">
        <div class="screen1">

            <div class="console">
                <div class="line1"><span class="cursor" data-word="计算机之父——图灵"></span></div>
                <div class="line2"><span class="cursor" data-word="破译德军密码"></span></div>
                <div class="line3"><span class="cursor" data-word="提前结束二战"></span></div>
            </div>
            <img src="../img/h5/tl1.png" alt="" id="tl1" class="tl1">

            <img src="../img/h5/cloud.png" alt="" class="cloud c1">
            <img src="../img/h5/cloud.png" alt="" class="cloud c2">
            <img src="../img/h5/cloud.png" alt="" class="cloud c3">
            <img src="../img/h5/cloud.png" alt="" class="cloud c4">
            <img src="../img/h5/cloud.png" alt="" class="cloud c5">

            <img src="../img/h5/bomb.png" alt="" class="bomb b1">
            <img src="../img/h5/bomb.png" alt="" class="bomb b2">


        </div>

        <div class="screen2">
            <img src="../img/h5/tl2.png" alt="" id="tl2" class="tl2">
            <div class="console">
                <div class="line1"><span class="cursor" data-word="他，脑洞大，双脚更快"></span></div>
            </div>

            <div class="road">
                <img src="../img/h5/foot.png" alt="" class="foot f1">
                <img src="../img/h5/foot.png" alt="" class="foot f2">
                <img src="../img/h5/foot.png" alt="" class="foot f3">
                <img src="../img/h5/foot.png" alt="" class="foot f4">
                <img src="../img/h5/foot.png" alt="" class="foot f5">
                <img src="../img/h5/foot.png" alt="" class="foot f6">
            </div>
        </div>

        <div class="runner js-down">
            <div class="r r1"></div>
            <div class="r r2"></div>
            <div class="r r3"></div>
        </div>

    </section>
    <section class="section bg2 s3">
        <div class="screen1">

            <div class="console">
                <div class="line1"><span class="cursor" data-word="跑步让身体强壮"></span></div>
                <div class="line2"><span class="cursor" data-word="让思维清晰"></span></div>
                <div class="line3"><span class="cursor" data-word="猜，我跑得有多快？"></span></div>
            </div>

            <img src="../img/h5/flower.png" alt="" class="flower f1">
            <img src="../img/h5/flower.png" alt="" class="flower f2">
            <img src="../img/h5/flower.png" alt="" class="flower f3">

            <img src="../img/h5/run.gif" alt="" id="run" class="run">
        </div>

        <div class="screen2">
            <div class="console">
                <div class="line1"><span class="cursor" data-word="今年奥运会冠军成绩是2小时8分44秒"></span></div>
                <div class="line2"><span class="cursor" data-word="图灵的马拉松最好成绩是"></span></div>
            </div>

            <img src="../img/h5/arrow.png" alt="" id="arrow" class="arrow"/>

            <img src="../img/h5/time.png" alt="" class="time" id="time"/>

            <img src="../img/h5/shake_hands.png" alt="" id="shake-hand" class="shake-hand"/>

            <div class="shadow" id="shadow"></div>

            <div id="dialog" class="dialog">
                恭喜你! <br/>
                摇的速度超过了<span class="num"></span>%的人
            </div>
        </div>

    </section>
    <section class="section bg3 s4">
        <div class="console1 white console">
            <div class="line1"><span class="cursor" data-word="向计算机之父/跑者——图灵致敬！"></span></div>
        </div>
        <div class="console console2 white">
            <div class="line1"><span class="cursor" data-word="首个DT+AR  RUN"></span></div>
            <div class="line2"><span class="cursor" data-word="诚邀你参加2016云栖夜跑"></span></div>
            <div class="line3"><span class="cursor" data-word="TechGO"></span></div>
        </div>
        <img src="../img/h5/circles.png" alt="" class="circle c1">
        <img src="../img/h5/circles.png" alt="" class="circle c2">
        <img src="../img/h5/circles.png" alt="" class="circle c3">

        <div class="apply-wrap" id="apply-wrap">
            <p class="msg">
                时间：10月14日<br>地点：云栖小镇
            </p>
            <a href="http://peinipao.cn/event?id=29101">我要去现场</a>
            <a href="http://peinipao.cn/event?id=30642">我要线上跑</a>
        </div>
    </section>

</div>
<audio src="../src/bg.mp3" id="music-bg" loop="loop"></audio>
<audio src="../src/keyboard.mp3" id="music-print" loop="loop"></audio>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.8.6/jquery.fullPage.min.js"></script>
<!--<script src="../js/h5.js"></script>-->
<script>
    function Printer(cfg) {

        if (this.constructor != Printer) {
            return new Printer(cfg)
        }
        this.cfg = $.extend({
            pauseTime : 200,//ms
            tag : 'span',
            callback : null,
            audio : true,
            audioId : 'music-print'
        }, cfg);

        if (this.cfg.audio) {
            this.audio = document.getElementById(this.cfg.audioId);
        }
    }

    Printer.prototype = {
        constructor : Printer,
        write : function (cursor, word, callback) {
            cursor.style.display = 'inline-block';
            this.audio && this.audio.play();
            var i = 0;
            var interval = setInterval(function () {
                if (i >= word.length) {
                    cursor.style.display = 'none';
                    this.audio && this.audio.pause();
                    callback && callback();
                    return clearInterval(interval);
                }
                this.pushLetter(cursor, word[i++]);
            }.bind(this), this.cfg.pauseTime)
        },
        pushLetter : function (cursor, letter) {
            var elem = document.createElement(this.cfg.tag);
            elem.innerText = letter;
            cursor.parentNode.insertBefore(elem, cursor);
        }

    };

    (function () {

        var hasStart = false;

        function start() {
            if (hasStart) {
                return
            }
            hasStart = true;

            $('#loading-wrap').remove();

            var p = new Printer;
            var cache = {};
            $('#wrap').fullpage({
                // anchors : ['s1', 's2', 's3', 's4', 's5'],
                afterLoad : function (a, index) {
                    if (cache[index])
                        return;
                    else
                        cache[index] = true;

                    $('.s'+(index+1)).find('[data-src]').each(function () {
                        this.src = this.dataset.src
                    });

                    switch (index) {
                        case 1:
                            setTimeout(function () {
                                $('.computer').addClass('show');
                                var $cursor = $('.s1 .cursor');
                                p.write($cursor[0], $cursor.eq(0).data('word'), function () {
                                    p.write($cursor[1], $cursor.eq(1).data('word'), function () {
                                        p.write($cursor[2], $cursor.eq(2).data('word'), function () {
                                            $('.s1 .runner').show();
                                        })
                                    });
                                });

                            }, 100);
                            break;
                        case 2:
                            setTimeout(function () {
                                $('#tl1').addClass('show');
                                setTimeout(function () {
                                    var $cursor = $('.s2 .cursor');
                                    p.write($cursor[0], $cursor.eq(0).data('word'), function () {
                                        p.write($cursor[1], $cursor.eq(1).data('word'), function () {
                                            p.write($cursor[2], $cursor.eq(2).data('word'), function () {
                                                setTimeout(toggleScreen, 1000);
                                            })
                                        });
                                    });
                                    $('.s2 .cloud').each(function (index, item) {
                                        setTimeout(function () {
                                            $(item).addClass('show');
                                        }, index * 100)
                                    });
                                    $('.s2 .bomb').addClass('show');
                                }, 800);

                            }, 100);


                        function toggleScreen() {
                            $('.s2 .screen1').fadeOut(300, function () {
                                $('.s2 .screen2').fadeIn(300, function () {
                                    var $cursor = $(this).find('.cursor');
                                    p.write($cursor[0], $cursor.data('word'), showFoot);
                                });
                            });
                        }

                        function showFoot() {
                            var $feet = $('.road .foot');
                            var i = 0;
                            var interval = setInterval(function () {
                                $feet.eq(i++).show(300);
                                if (i == $feet.length) {
                                    clearInterval(interval);
                                    $('.s2 .runner').show();
                                }
                            }, 150);
                        }
                            break;
                        case 3:
                            var $cursor = $('.s3 .cursor');
                            var shakeInterval;

                            p.write($cursor[0], $cursor.eq(0).data('word'), function () {
                                p.write($cursor[1], $cursor.eq(1).data('word'), function () {
                                    p.write($cursor[2], $cursor.eq(2).data('word'), function () {
                                        setTimeout(function () {
                                            $('.s3').addClass('bg1').removeClass('bg2');
                                            toggleScreen_3();
                                        }, 1000);
                                    })
                                });
                            });
                        function toggleScreen_3() {
                            $('.s3 .screen1').fadeOut(300, function () {
                                $('.s3 .screen2').fadeIn(300, function () {
                                    $('#arrow').show(300, function () {
                                        $('#time').addClass('show');

                                        setTimeout(function () {
                                            $('#shake-hand').addClass('shake');
                                            listenCallback();
                                        }, 1000);
                                    });
                                    // var $cursor = $(this).find('.cursor');
                                    // p.write($cursor[0], $cursor.eq(0).data('word'), function () {
                                    //     p.write($cursor[1], $cursor.eq(1).data('word'), function () {
                                    //
                                    //     })
                                    // });
                                });
                            });
                        }

                        function listenCallback() {
                            var shakeThreshold = 1000; // 定义一个摇动的阈值
                            var lastUpdate = 0; // 记录上一次摇动的时间
                            var x, y, z, lastX, lastY, lastZ; // 定义x、y、z记录三个轴的数据以及上一次触发的数据

                            // 监听传感器运动事件
                            if (window.DeviceMotionEvent) {
                                window.addEventListener('devicemotion', deviceMotionHandler, false);
                            } else {
                                // alert('本设备不支持devicemotion事件');
                                // $('#shake-hand').one('click', shakeCallback);
                            }
                            $('#shake-hand').one('click', shakeCallback);

                            // 运动传感器处理
                            var shakeCount = 0;
                            function deviceMotionHandler(eventData) {
                                var acceleration = eventData.accelerationIncludingGravity; // 获取含重力的加速度
                                var curTime = new Date().getTime();

                                // 100毫秒进行一次位置判断
                                if ((curTime - lastUpdate) > 100) {

                                    var dif fTime = curTime - lastUpdate;
                                    lastUpdate = curTime;

                                    x = acceleration.x;
                                    y = acceleration.y;
                                    z = acceleration.z;

                                    var speed = Math.abs(x + y + z - lastX - lastY - lastZ) / diffTime * 10000;
                                    // 前后x, y, z间的差值的绝对值和时间比率超过了预设的阈值，则判断设备进行了摇晃操作
                                    if (speed > shakeThreshold) {
                                        shakeCount ++
                                        if (shakeCount >= 3) {
                                            shakeCallback();
                                        }
                                    }

                                    lastX = x;
                                    lastY = y;
                                    lastZ = z;
                                }
                            }

                            shakeInterval = setInterval(function () {
                                shakeCount--;
                                shakeCount = Math.max(shakeCount, 0);
                            }, 1000);
                        }

                        function shakeCallback() {
                            $('#shadow').show();
                            $('#dialog').show().find('.num').text(~~(Math.random() * 27) + 70);

                            try {
                                window.removeEventListener('devicemotion', deviceMotionHandler, false);
                            } catch (e){

                            }

                            setTimeout(function () {
                                $.fn.fullpage.moveSectionDown();
                            }, 3000)
                        }

                            break;
                        case 4:
                            var $cursor = $('.s4 .cursor');
                            $('#apply-wrap').addClass('show');
                            // p.write($cursor[0], $cursor.eq(0).data('word'), function () {
                            //     p.write($cursor[1], $cursor.eq(1).data('word'), function () {
                            //         p.write($cursor[2], $cursor.eq(2).data('word'), function () {
                            //             p.write($cursor[3], $cursor.eq(3).data('word'), function () {
                            //
                            //             })
                            //         })
                            //     });
                            // });
                            break;
                    }
                    console.log(index)
                }
            });
            var fullpage = $.fn.fullpage;

            /**
             * 向下移动
             */
            $('.js-down').one('click', function () {
                fullpage.moveSectionDown();
            });
        }


        //lazyload

        (function () {
            var src1 = $('.computer')[0].src;
            var img1 = new Image;
            img1.onload = function () {
                start();
            };
            img1.src = src1;

            setTimeout(start, 3000);
        })();






    })();
</script>
</body>
</html>
